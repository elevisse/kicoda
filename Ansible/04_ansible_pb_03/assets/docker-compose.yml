version: "3"

networks:
  sshnet:
    driver: bridge
    ipam:
      config:
        - subnet: 10.1.0.0/16

volumes:
  opt:
  root:
  usrlib:

services:
  node01:
    environment:
      - ROOT_PASSWORD=ubuntu
    image: takeyamajp/ubuntu-sshd
    networks:
      sshnet:
        ipv4_address: 10.1.1.1
    restart: always
  node02:
    image: takeyamajp/rocky-sshd
    networks:
      sshnet:
        ipv4_address: 10.1.1.2
    restart: always
  node03:
    environment:
      - ROOT_PASSWORD=ubuntu
    image: takeyamajp/ubuntu-sshd
    networks:
      sshnet:
        ipv4_address: 10.1.1.3
    volumes:
      - opt:/opt
      - root:/root
      - usrlib:/usr/lib
    restart: always
    command: >
      sh -ceux '
      find /root/ -prune -type f -executable -exec "{}" \; &&
      /usr/sbin/sshd -D -e
      '
  node04:
    environment:
      - ROOT_PASSWORD=ubuntu
    image: takeyamajp/ubuntu-sshd
    networks:
      sshnet:
        ipv4_address: 10.1.1.4
    restart: always
